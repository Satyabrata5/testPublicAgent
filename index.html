<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1">
    <title>Google</title>
    <link rel="stylesheet" href="style.css"> 
    <link rel="icon" href="https://www.google.com/favicon.ico" type="image/x-icon">
</head>
<body>
    <main class="container">
        <img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png" alt="Google logo">

        <form action="https://www.google.com/search" method="GET" class="search-form">
            <div class="search-bar">
                <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input type="text" name="q" title="Search" aria-label="Search">
            </div>

            <div class="search-buttons">
                <input type="submit" value="Google Search">
                <input type="button" value="I'm Feeling Lucky" onclick="startChat()">
            </div>
        </form>
    </main>
    
    <script type='text/javascript'>
        let isChatReady = false;
        let wasButtonClicked = false;

        /**
         * This function is called when the "I'm Feeling Lucky" button is clicked.
         */
        function startChat() {
            wasButtonClicked = true; // Record that the user wants to start a chat
            embeddedservice_bootstrap.settings.language = 'en_US';
            // If the chat service is already ready, open the window immediately.
            if (isChatReady) {
                console.log("Service is ready. Launching chat now.");
                embeddedservice_bootstrap.utilAPI.launchChat();
            } else {
                // If the service is NOT ready, initialize it.
                // The event listener below will handle opening the window when it's ready.
                console.log("Service not yet ready. Initializing...");
                try {
                    embeddedservice_bootstrap.init(
                        '00D9X00000TUFNj',
                        'Service_Agent',
                        'https://coop-csc--agentdev.sandbox.my.site.com/ESWServiceAgent1757506538642',
                        {
                            scrt2URL: 'https://coop-csc--agentdev.sandbox.my.salesforce-scrt.com'
                        }
                    );
                } catch (err) {
                    console.error('Error on init: ', err);
                }
            }
        }

        /**
         * This listener waits for the 'embeddedservice.ready' event from Salesforce.
         * This is the most reliable way to know when the API is available.
         */
        window.addEventListener("embeddedservice.ready", function() {
            console.log("Event 'embeddedservice.ready' fired. Service is now available.");
            isChatReady = true; // Mark the service as ready to use.

            // If the user already clicked the button, open the chat window now.
            if (wasButtonClicked) {
                console.log("Button was already clicked. Launching chat window.");
                embeddedservice_bootstrap.utilAPI.launchChat();
            }
        });
    </script>
    
    <script type='text/javascript' src='https://coop-csc--agentdev.sandbox.my.site.com/ESWServiceAgent1757506538642/assets/js/bootstrap.min.js'></script>
</body>
</html>
